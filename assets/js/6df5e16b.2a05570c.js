(self.webpackChunkjarbird_docs=self.webpackChunkjarbird_docs||[]).push([[563],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return m}});var i=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=i.createContext({}),p=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(n),m=r,g=c["".concat(s,".").concat(m)]||c[m]||d[m]||a;return n?i.createElement(g,o(o({ref:t},u),{},{components:n})):i.createElement(g,o({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<a;p++)o[p]=n[p];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}c.displayName="MDXCreateElement"},8215:function(e,t,n){"use strict";var i=n(7294);t.Z=function(e){var t=e.children,n=e.hidden,r=e.className;return i.createElement("div",{role:"tabpanel",hidden:n,className:r},t)}},1395:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var i=n(7294),r=n(944),a=n(6010),o="tabItem_1uMI",l="tabItemActive_2DSg";var s=37,p=39;var u=function(e){var t=e.lazy,n=e.block,u=e.defaultValue,d=e.values,c=e.groupId,m=e.className,g=(0,r.Z)(),h=g.tabGroupChoices,f=g.setTabGroupChoices,b=(0,i.useState)(u),k=b[0],y=b[1],v=i.Children.toArray(e.children),N=[];if(null!=c){var w=h[c];null!=w&&w!==k&&d.some((function(e){return e.value===w}))&&y(w)}var j=function(e){var t=e.currentTarget,n=N.indexOf(t),i=d[n].value;y(i),null!=c&&(f(c,i),setTimeout((function(){var e,n,i,r,a,o,s,p;(e=t.getBoundingClientRect(),n=e.top,i=e.left,r=e.bottom,a=e.right,o=window,s=o.innerHeight,p=o.innerWidth,n>=0&&a<=p&&r<=s&&i>=0)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(l),setTimeout((function(){return t.classList.remove(l)}),2e3))}),150))},C=function(e){var t,n;switch(e.keyCode){case p:var i=N.indexOf(e.target)+1;n=N[i]||N[0];break;case s:var r=N.indexOf(e.target)-1;n=N[r]||N[N.length-1]}null==(t=n)||t.focus()};return i.createElement("div",{className:"tabs-container"},i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":n},m)},d.map((function(e){var t=e.value,n=e.label;return i.createElement("li",{role:"tab",tabIndex:k===t?0:-1,"aria-selected":k===t,className:(0,a.Z)("tabs__item",o,{"tabs__item--active":k===t}),key:t,ref:function(e){return N.push(e)},onKeyDown:C,onFocus:j,onClick:j},n)}))),t?(0,i.cloneElement)(v.filter((function(e){return e.props.value===k}))[0],{className:"margin-vert--md"}):i.createElement("div",{className:"margin-vert--md"},v.map((function(e,t){return(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==k})}))))}},9443:function(e,t,n){"use strict";var i=(0,n(7294).createContext)(void 0);t.Z=i},944:function(e,t,n){"use strict";var i=n(7294),r=n(9443);t.Z=function(){var e=(0,i.useContext)(r.Z);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},5459:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return s},metadata:function(){return p},toc:function(){return u},default:function(){return c}});var i=n(2122),r=n(9756),a=(n(7294),n(3905)),o=n(1395),l=n(8215),s={title:"Simple Library with Signature",tags:"tutorial",sidebar_label:"Library with Signature",sidebar_position:3},p={unversionedId:"tutorials/samplelibsign",id:"tutorials/samplelibsign",isDocsHomePage:!1,title:"Simple Library with Signature",description:"In this tutorial we are going to build out minimal component with digital",source:"@site/docs/tutorials/samplelibsign.mdx",sourceDirName:"tutorials",slug:"/tutorials/samplelibsign",permalink:"/jarbird/docs/tutorials/samplelibsign",editUrl:"https://github.com/hkhc/jarbird-docs/docs/tutorials/samplelibsign.mdx",version:"current",sidebar_label:"Library with Signature",sidebarPosition:3,frontMatter:{title:"Simple Library with Signature",tags:"tutorial",sidebar_label:"Library with Signature",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Simple library - A minimal demo",permalink:"/jarbird/docs/tutorials/simplelib"},next:{title:"Publish to Maven Central",permalink:"/jarbird/docs/tutorials/mavencentral"}},u=[{value:"GnuPG",id:"gnupg",children:[]},{value:'<a name="project-setup"></a>Project setup',id:"project-setup",children:[{value:"gradle.properties",id:"gradleproperties",children:[]},{value:"pom.yaml",id:"pomyaml",children:[]},{value:"Run it",id:"run-it",children:[]},{value:"Get rid of GnuPG warning",id:"get-rid-of-gnupg-warning",children:[]}]},{value:"In case I forget to configure signing key",id:"in-case-i-forget-to-configure-signing-key",children:[]}],d={toc:u};function c(e){var t=e.components,n=(0,r.Z)(e,["components"]);return(0,a.kt)("wrapper",(0,i.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"In this tutorial we are going to build out minimal component with digital\nsignature."),(0,a.kt)("p",null,"The sample project is ","[here]","(",(0,a.kt)("a",{parentName:"p",href:"https://github."},"https://github."),"\ncom/hkhc/jarbird-samples/tree/master/simplelib-sign)."),(0,a.kt)("h2",{id:"gnupg"},"GnuPG"),(0,a.kt)("p",null,"First we need to set up signing key pair. (If you already have it, just\n",(0,a.kt)("a",{parentName:"p",href:"#project-setup"},"skip"),' this part) It is a one off task, that we may reuse\nthe key pair for all of our projects. There are various choices to do so,\nbut we do the simplest thing here. Please refer to the "Signing\nconfiguration" (TODO) for other possibilities.'),(0,a.kt)("p",null,"We need to have an implementation of GnuPG installed on our computer. There are a few choices:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://gnupg.org/"},"GnuPG")," 2.2 or above (Unix/Mac)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://gpgtools.org"},"GPGTools")," (Mac)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://gpg4win.org"},"Gpg4win")," (Windows).")),(0,a.kt)("p",null,"Keypair can be generated by the command ",(0,a.kt)("inlineCode",{parentName:"p"},"gpg --gen-key"),". We need to provide name and email address."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell-session",metastring:"{10,11,15}","{10,11,15}":!0},'$ gpg --gen-key\ngpg (GnuPG/MacGPG2) 2.2.24; Copyright (C) 2020 Free Software Foundation, Inc.\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\n\nNote: Use "gpg --full-generate-key" for a full featured key generation dialog.\n\nGnuPG needs to construct a user ID to identify your key.\n\nReal name: Jarbird Demo\nEmail address: jarbird.demo@fake-email.com\nYou selected this USER-ID:\n    "Jarbird Demo <jarbird.demo@fake-email.com>"\n\nChange (N)ame, (E)mail, or (O)kay/(Q)uit? O\n')),(0,a.kt)("p",null,"You will be asked for a passphrase to protect the key pair at this point. It\nis passphrase of your keybox file. If you already have it, use the same passphrase. Otherwise, create a new passphrase and keep it safe."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell-session",metastring:"{14}","{14}":!0},"We need to generate a lot of random bytes. It is a good idea to perform\nsome other action (type on the keyboard, move the mouse, utilize the\ndisks) during the prime generation; this gives the random number\ngenerator a better chance to gain enough entropy.\nWe need to generate a lot of random bytes. It is a good idea to perform\nsome other action (type on the keyboard, move the mouse, utilize the\ndisks) during the prime generation; this gives the random number\ngenerator a better chance to gain enough entropy.\ngpg: key BCCF8CD8B61806FE marked as ultimately trusted\ngpg: revocation certificate stored as '/Users/me/.gnupg/openpgp-revocs.d/6BA0B340ABB2411040589423BCCF8CD8B61806FE.rev'\npublic and secret key created and signed.\n\npub   rsa3072 2021-05-12 [SC] [expires: 2023-05-12]\n      6BA0B340ABB2411040589423BCCF8CD8B61806FE\nuid                      Jarbird Demo <jarbird.demo@fake-email.com>\nsub   rsa3072 2021-05-12 [E] [expires: 2023-05-12]\n$\n")),(0,a.kt)("p",null,"The generated key is identified by the key ID (that ended with ",(0,a.kt)("inlineCode",{parentName:"p"},"B61806FE"),")"),(0,a.kt)("h2",{id:"project-setup"},(0,a.kt)("a",{name:"project-setup"}),"Project setup"),(0,a.kt)("h3",{id:"gradleproperties"},"gradle.properties"),(0,a.kt)("p",null,"The build script is configured to use the key ID and passphrease by putting them in gradle.properties. It could be the ",(0,a.kt)("inlineCode",{parentName:"p"},"~/.gradle/gradle.properties")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"gradle.properties")," under the project directory."),(0,a.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"However, putting this information at ",(0,a.kt)("inlineCode",{parentName:"p"},"~/.gradle/gradle.properties")," is\npreferable to avoid putting sensitive information in project."),(0,a.kt)("p",{parentName:"div"},"TODO CI/CD"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-properties",metastring:'title="~/.gradle/gradle.properties"',title:'"~/.gradle/gradle.properties"'},"# ...\nsigning.gnupg.keyName=B61806FE\nsigning.gnupg.passphrase=your-GnuPg-passphrase\n# ...\n")),(0,a.kt)("p",null,"The keyName is the last 8 characters of the key ID in the result of key generation. If you forget it, use ",(0,a.kt)("inlineCode",{parentName:"p"},"gpg --list-key")," to find it."),(0,a.kt)("p",null,"Now we have key pair, then we may update the component version in ",(0,a.kt)("inlineCode",{parentName:"p"},"pom.yaml")),(0,a.kt)("h3",{id:"pomyaml"},"pom.yaml"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="pom.yaml" {3}',title:'"pom.yaml"',"{3}":!0},"group: jarbirdsamples\nartifactId: simplelib\nversion: 1.0\n")),(0,a.kt)("p",null,"The version suffix ",(0,a.kt)("inlineCode",{parentName:"p"},"-SNAPSHOT")," is removed. Then we may publish the component again:"),(0,a.kt)("h3",{id:"run-it"},"Run it"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell-session",metastring:"{4}","{4}":!0},"$ ./gradlew jbPublish\n\n> Configure project :\nWARNING: [io.hkhc.jarbird] Setting to use gpg keyring file but signing gpg keybox  configuration is found. Switch to use gpg keybox\n\n> Task :jbDokkaHtmlSimplelib\nInitializing plugins\nDokka is performing: documentation for simplelib\nValidity check\nCreating documentation models\n\nWARN: The registry key 'java.correct.class.type.by.place.resolve.scope' accessed, but not loaded yet\n\n> Task :jbDokkaHtmlSimplelib\nTransforming documentation model before merging\nMerging documentation models\nTransforming documentation model after merging\nCreating pages\nTransforming pages\nRendering\n\n\nBUILD SUCCESSFUL in 8s\n9 actionable tasks: 9 executed\n")),(0,a.kt)("p",null,"Then we complete component publishing."),(0,a.kt)("h3",{id:"get-rid-of-gnupg-warning"},"Get rid of GnuPG warning"),(0,a.kt)("p",null,"We have a warning indicates that Jarbird expects to find the old style keyring\nfile, but not found. So it tries to find the signing key pair in newer keybox file.\nTo get rid of the warning, we may tell Jarbird explicitly that we want to use\nkeybox file. This can be done by updating the ",(0,a.kt)("inlineCode",{parentName:"p"},"build.gradle")," file."),(0,a.kt)(o.Z,{defaultValue:"buildgradle",values:[{label:"build.gradle",value:"buildgradle"},{label:"build.gradle.kts",value:"buildgradlekts"}],mdxType:"Tabs"},(0,a.kt)(l.Z,{value:"buildgradle",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-groovy",metastring:"{5}","{5}":!0},"// ...\njarbird {\n    pub {\n        mavenLocal()\n        signWithKeybox()\n    }\n}\n// ...\n"))),(0,a.kt)(l.Z,{value:"buildgradlekts",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:"{5}","{5}":!0},"// ...\njarbird {\n    pub {\n        mavenLocal()\n        signWithKeybox()\n    }\n}\n// ...\n")))),(0,a.kt)("p",null,"Then we have clean result without such warning."),(0,a.kt)("p",null,"Nevertheless, the produced results are the same, in ",(0,a.kt)("inlineCode",{parentName:"p"},"~/.me/repository/jarbirdsamples/simplelib/1.0")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell-session"},"$ ls -1 ~/.m2/repository/jarbirdsamples/simplelib/1.0\nsimplelib-1.0-javadoc.jar\nsimplelib-1.0-javadoc.jar.asc\nsimplelib-1.0-sources.jar\nsimplelib-1.0-sources.jar.asc\nsimplelib-1.0.jar\nsimplelib-1.0.jar.asc\nsimplelib-1.0.module\nsimplelib-1.0.module.asc\nsimplelib-1.0.pom\nsimplelib-1.0.pom.asc\n")),(0,a.kt)("p",null,"The files with ",(0,a.kt)("inlineCode",{parentName:"p"},".asc")," extension are the signature file.\nNote that the ",(0,a.kt)("inlineCode",{parentName:"p"},"metadata-local.xml")," file when building ",(0,a.kt)("inlineCode",{parentName:"p"},"1.0-SNAPSHOT")," is not\nhere. The non ",(0,a.kt)("inlineCode",{parentName:"p"},"SNAPSHOT")," version does not need the file."),(0,a.kt)("h2",{id:"in-case-i-forget-to-configure-signing-key"},"In case I forget to configure signing key"),(0,a.kt)("p",null,"The sample project ",(0,a.kt)("inlineCode",{parentName:"p"},"simplelib-sign")," illustrates the publishing of signed component.\nAdd your signing key configuration in gradle.properties before run. If there is no\nkey configuration provided, and the publication is not SNAPSHOT version, then\nthe following warning is shown when doing ",(0,a.kt)("inlineCode",{parentName:"p"},"./gradlew jbPublish")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell-session"},"WARNING: [io.hkhc.jarbird] No signing setting is provided. Signing operation is ignored. Maven Central publishing cannot be done without signing the artifacts.\nWARNING: [io.hkhc.jarbird] Signing configuration for keybox file is not complete. Signing operation is ignored. Maven Central publishing cannot be done without signing the artifacts.\n")))}c.isMDXComponent=!0},6010:function(e,t,n){"use strict";function i(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=i(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}function r(){for(var e,t,n=0,r="";n<arguments.length;)(e=arguments[n++])&&(t=i(e))&&(r&&(r+=" "),r+=t);return r}n.d(t,{Z:function(){return r}})}}]);