(self.webpackChunkjarbird_docs=self.webpackChunkjarbird_docs||[]).push([[563],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return c}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),p=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(n),c=a,g=d["".concat(s,".").concat(c)]||d[c]||m[c]||i;return n?r.createElement(g,o(o({ref:t},u),{},{components:n})):r.createElement(g,o({ref:t},u))}));function c(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5459:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return l},metadata:function(){return s},toc:function(){return p},default:function(){return m}});var r=n(2122),a=n(9756),i=(n(7294),n(3905)),o={title:"Simple Library with Signature",tags:"tutorial",sidebar_label:"Library with Signature",sidebar_position:3},l=void 0,s={unversionedId:"tutorials/samplelibsign",id:"tutorials/samplelibsign",isDocsHomePage:!1,title:"Simple Library with Signature",description:"In this tutorial, we are going to build our minimal component with a digital signature.",source:"@site/docs/tutorials/samplelibsign.mdx",sourceDirName:"tutorials",slug:"/tutorials/samplelibsign",permalink:"/jarbird/docs/tutorials/samplelibsign",editUrl:"https://github.com/hkhc/jarbird-docs/docs/tutorials/samplelibsign.mdx",version:"current",sidebarPosition:3,frontMatter:{title:"Simple Library with Signature",tags:"tutorial",sidebar_label:"Library with Signature",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Simple library",permalink:"/jarbird/docs/tutorials/simplelib"},next:{title:"Publish to Maven Central",permalink:"/jarbird/docs/tutorials/mavencentral"}},p=[{value:'<a name="project-setup"></a>Project setup',id:"project-setup",children:[{value:"pom.yaml",id:"pomyaml",children:[]},{value:"Run it, the first attempt",id:"run-it-the-first-attempt",children:[]},{value:"GnuPG",id:"gnupg",children:[]},{value:"gradle.properties",id:"gradleproperties",children:[]},{value:"Run it, the second attempt",id:"run-it-the-second-attempt",children:[]}]},{value:'Bonus: Setup temporary Gradle environment for tutorial <a href="#gradle-home"></a>',id:"bonus-setup-temporary-gradle-environment-for-tutorial",children:[]}],u={toc:p};function m(e){var t=e.components,n=(0,a.Z)(e,["components"]);return(0,i.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"In this tutorial, we are going to build our minimal component with a digital signature."),(0,i.kt)("p",null,"The sample project is ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/hkhc/jarbird-samples/tree/master/simplelib-sign"},"here"),"."),(0,i.kt)("h2",{id:"project-setup"},(0,i.kt)("a",{name:"project-setup"}),"Project setup"),(0,i.kt)("h3",{id:"pomyaml"},"pom.yaml"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="pom.yaml" {3}',title:'"pom.yaml"',"{3}":!0},"group: jarbirdsamples\nartifactId: simplelib\nversion: 1.0\n")),(0,i.kt)("p",null,"The version suffix ",(0,i.kt)("inlineCode",{parentName:"p"},"-SNAPSHOT")," is removed. Then we may publish the component again."),(0,i.kt)("p",null,"Before you start, you may want to ",(0,i.kt)("a",{parentName:"p",href:"#gradle-home"},"setup")," a temporary Gradle environment for this tutorial. Then your working environment will not be messed up."),(0,i.kt)("h3",{id:"run-it-the-first-attempt"},"Run it, the first attempt"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"$ ./gradlew jbPublish                                           \nBuild with Groovy build script\nFill in the property values in `gradle.properties` before build.\n\n> Task :signSimplelibPublication FAILED\ngpg: skipped \"........\": No secret key\ngpg: signing failed: No secret key\n\nFAILURE: Build failed with an exception.\n\n* What went wrong:\nExecution failed for task ':signSimplelibPublication'.\n> Process 'command 'gpg2'' finished with non-zero exit value 2\n")),(0,i.kt)("p",null,"It seems thing does not go well. It is because we have not set up the key used for signing the artefact."),(0,i.kt)("h3",{id:"gnupg"},"GnuPG"),(0,i.kt)("p",null,"We need to set up a signing key pair. (If you already have it, just ",(0,i.kt)("a",{parentName:"p",href:"#project-setup"},"skip")," this part) It is a one-off task, that we may reuse the key pair for all of our projects. There are various choices to do so, but we do the simplest thing here. Please refer to the ",(0,i.kt)("a",{parentName:"p",href:"../reference/pub#signing"},"Signing configuration")," for other possibilities."),(0,i.kt)("p",null,"We need to have an implementation of GnuPG installed on our computer. There are a few choices:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://gnupg.org/"},"GnuPG")," 2.2 or above (Unix/Mac)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://gpgtools.org"},"GPGTools")," (Mac)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://gpg4win.org"},"Gpg4win")," (Windows).")),(0,i.kt)("p",null,"Keypair can be generated by the command ",(0,i.kt)("inlineCode",{parentName:"p"},"gpg --gen-key"),". You need to provide your name and email address."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell-session",metastring:"{10,11,15}","{10,11,15}":!0},'$ gpg --gen-key\ngpg (GnuPG/MacGPG2) 2.2.24; Copyright (C) 2020 Free Software Foundation, Inc.\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\n\nNote: Use "gpg --full-generate-key" for a full-featured key generation dialog.\n\nGnuPG needs to construct a user ID to identify your key.\n\nReal name: Jarbird Demo\nEmail address: jarbird.demo@fake-email.com\nYou selected this USER-ID:\n    "Jarbird Demo <jarbird.demo@fake-email.com>"\n\nChange (N)ame, (E)mail, or (O)kay/(Q)uit? O\n')),(0,i.kt)("p",null,"You will be asked for a passphrase to protect the key pair at this point. It is a passphrase to protect your keybox file. If you already have a keybox, use the same passphrase. Otherwise, create a new passphrase and keep it safe."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell-session",metastring:"{14}","{14}":!0},"We need to generate a lot of random bytes. It is a good idea to perform\nsome other action (type on the keyboard, move the mouse, utilize the\ndisks) during the prime generation; this gives the random number\ngenerator a better chance to gain enough entropy.\nWe need to generate a lot of random bytes. It is a good idea to perform\nsome other action (type on the keyboard, move the mouse, utilize the\ndisks) during the prime generation; this gives the random number\ngenerator a better chance to gain enough entropy.\ngpg: key BCCF8CD8B61806FE marked as ultimately trusted\ngpg: revocation certificate stored as '/Users/me/.gnupg/openpgp-revocs.d/6BA0B340ABB2411040589423BCCF8CD8B61806FE.rev'\npublic and secret key created and signed.\n\npub   rsa3072 2021-05-12 [SC] [expires: 2023-05-12]\n      6BA0B340ABB2411040589423BCCF8CD8B61806FE\nuid                      Jarbird Demo <jarbird.demo@fake-email.com>\nsub   rsa3072 2021-05-12 [E] [expires: 2023-05-12]\n$\n")),(0,i.kt)("p",null,"The generated key is identified by the key ID (that ended with ",(0,i.kt)("inlineCode",{parentName:"p"},"B61806FE"),")"),(0,i.kt)("h3",{id:"gradleproperties"},"gradle.properties"),(0,i.kt)("p",null,"The Jarbird plugin uses the key ID and passphrase specified in ",(0,i.kt)("inlineCode",{parentName:"p"},"gradle.properties"),". It could be in ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.gradle/gradle.properties")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"gradle.properties")," under the project directory. We may also specify these pieces of information in environment variables, which may be more suitable for CI/CD environment."),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Putting this information at ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.gradle/gradle.properties")," or environment variable is preferable to avoid putting sensitive information in a project. we put the ",(0,i.kt)("inlineCode",{parentName:"p"},"gradle.properties")," in this project just for simplifying the demonstration."))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-properties",metastring:'title="gradle.properties"',title:'"gradle.properties"'},"# ...\nsigning.gnupg.keyName=B61806FE\nsigning.gnupg.passphrase=your-GnuPg-passphrase\n# ...\n")),(0,i.kt)("p",null,"The keyName is the last 8 characters of the key ID in the result of key generation. If you forget it, use ",(0,i.kt)("inlineCode",{parentName:"p"},"gpg --list-key")," to find it."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"gradle.properties")," in the sample project contains these entries for your reference."),(0,i.kt)("h3",{id:"run-it-the-second-attempt"},"Run it, the second attempt"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell-session",metastring:"{4}","{4}":!0},"$ ./gradlew jbPublish\nBuild with Groovy build script\nFill in the property values in gradle.properties before build.\n\n> Configure project :\n\n> Task :jbDokkaHtmlSimplelib\nInitializing plugins\nDokka is performing: documentation for simplelib\nValidity check\nCreating documentation models\n\nWARN: The registry key 'java.correct.class.type.by.place.resolve.scope' accessed, but not loaded yet\n\n> Task :jbDokkaHtmlSimplelib\nTransforming documentation model before merging\nMerging documentation models\nTransforming documentation model after merging\nCreating pages\nTransforming pages\nRendering\n\n\nBUILD SUCCESSFUL in 8s\n9 actionable tasks: 9 executed\n")),(0,i.kt)("p",null,"We did it successfully. The produced results are in ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.m2/repository/jarbirdsamples/simplelib/1.0")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell-session"},"$ ls -1 ~/.m2/repository/jarbirdsamples/simplelib/1.0\nsimplelib-1.0-javadoc.jar\nsimplelib-1.0-javadoc.jar.asc\nsimplelib-1.0-sources.jar\nsimplelib-1.0-sources.jar.asc\nsimplelib-1.0.jar\nsimplelib-1.0.jar.asc\nsimplelib-1.0.module\nsimplelib-1.0.module.asc\nsimplelib-1.0.pom\nsimplelib-1.0.pom.asc\n")),(0,i.kt)("p",null,"The files with the ",(0,i.kt)("inlineCode",{parentName:"p"},".asc")," extension are the signature file. Note that the ",(0,i.kt)("inlineCode",{parentName:"p"},"metadata-local.xml")," file when building ",(0,i.kt)("inlineCode",{parentName:"p"},"1.0-SNAPSHOT")," is not here. The non ",(0,i.kt)("inlineCode",{parentName:"p"},"SNAPSHOT")," version does not need the file."),(0,i.kt)("h2",{id:"bonus-setup-temporary-gradle-environment-for-tutorial"},"Bonus: Setup temporary Gradle environment for tutorial ",(0,i.kt)("a",{href:"#gradle-home"})),(0,i.kt)("p",null,"We may set up an isolated Gradle environment for this tutorial. set the environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"GRADLE_USER_HOME")," like this."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell-session"},"export GRADLE_USER_HOME=~/.gradle_jarbird_trial\n")),(0,i.kt)("p",null,"Then Gradle uses the directory ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.gradle_jarbird_trial")," instead of the default ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.gradle")," for all working and caching files."),(0,i.kt)("p",null,"If you are using zsh shell, you may want to enable ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/zpm-zsh/autoenv"},(0,i.kt)("inlineCode",{parentName:"a"},"autoenv")," plugin")," so that it is done automatically."),(0,i.kt)("p",null,"In this sample, we have set up the environment variable in the ",(0,i.kt)("inlineCode",{parentName:"p"},".in")," file and undo it in the ",(0,i.kt)("inlineCode",{parentName:"p"},".out")," file."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell-session",metastring:'title=".in"',title:'".in"'},"# setup GRADLE_USER_HOME automatically for https://github.com/zpm-zsh/autoenv\nexport GRADLE_USER_HOME=~/.gradle_jarbird_trial\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell-session",metastring:'title=".out"',title:'".out"'},"# setup GRADLE_USER_HOME automatically for https://github.com/zpm-zsh/autoenv\nunset GRADLE_USER_HOME\n")),(0,i.kt)("p",null,"It may take a while to use this alternate environment to build the Gradle project for the first time. It will load the Gradle itself, and all plugin and library dependencies for this project."))}m.isMDXComponent=!0}}]);